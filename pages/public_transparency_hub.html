<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Public Transparency Hub - CitizenVoice</title>
    <link rel="stylesheet" href="../css/main.css" />
    <meta name="description" content="Explore public complaint data, agency performance metrics, and community trends through CitizenVoice's transparent accountability platform." />
  <script type="module" defer src="https://static.rocket.new/rocket-shot.js?v=0.0.1"></script>
  
  <script type="module" async src="https://static.rocket.new/rocket-web.js?_cfg=https%3A%2F%2Fcitizenvoi3231back.builtwithrocket.new&_be=https%3A%2F%2Fapplication.rocket.new&_v=0.1.12"></script>
  <script type="module" defer src="https://static.rocket.new/rocket-shot.js?v=0.0.2"></script>
  </head>
<body class="bg-background">
    <!-- Navigation Header -->
    <nav class="bg-surface shadow-card sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Logo -->
                <div class="flex items-center">
                    <svg class="h-8 w-8 text-primary mr-3" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2L13.09 8.26L20 9L13.09 9.74L12 16L10.91 9.74L4 9L10.91 8.26L12 2Z"/>
                        <circle cx="12" cy="12" r="3" fill="none" stroke="currentColor" stroke-width="2"/>
                    </svg>
                    <span class="text-xl font-bold text-primary">CitizenVoice</span>
                </div>
                
                <!-- Desktop Navigation -->
                <div class="hidden md:flex items-center space-x-8">
                    <a href="homepage.html" class="text-text-secondary hover:text-primary transition-colors">Home</a>
                    <a href="submit_complaint.html" class="text-text-secondary hover:text-primary transition-colors">Submit Complaint</a>
                    <a href="track_progress.html" class="text-text-secondary hover:text-primary transition-colors">Track Progress</a>
                    <a href="public_transparency_hub.html" class="text-primary font-semibold">Public Hub</a>
                    <a href="community_forum.html" class="text-text-secondary hover:text-primary transition-colors">Community</a>
                    <span id="auth-links">
                        <a href="login.html" class="btn-outline text-sm py-2 px-4" id="login-link">Login / Agency Login</a>
                        <button type="button" onclick="logout()" class="btn-outline text-sm py-2 px-4 hidden" id="logout-btn">Logout</button>
                    </span>
                </div>
                
                <!-- Mobile Menu Button -->
                <div class="md:hidden">
                    <button type="button" id="mobile-menu-button" class="text-text-secondary hover:text-primary" aria-label="Toggle mobile menu">
                        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden md:hidden bg-surface border-t border-border">
            <div class="px-2 pt-2 pb-3 space-y-1">
                <a href="homepage.html" class="block px-3 py-2 text-text-secondary hover:text-primary">Home</a>
                <a href="submit_complaint.html" class="block px-3 py-2 text-text-secondary hover:text-primary">Submit Complaint</a>
                <a href="track_progress.html" class="block px-3 py-2 text-text-secondary hover:text-primary">Track Progress</a>
                <a href="public_transparency_hub.html" class="block px-3 py-2 text-primary font-semibold">Public Hub</a>
                <a href="community_forum.html" class="block px-3 py-2 text-text-secondary hover:text-primary">Community</a>
                <a href="login.html" class="block px-3 py-2 text-primary font-semibold">Agency Login</a>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="bg-gradient-to-br from-primary-50 to-secondary-50 py-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-12">
                <h1 class="text-4xl md:text-5xl font-bold text-text-primary mb-6">
                    Public Transparency Hub
                </h1>
                <p class="text-lg md:text-xl text-text-secondary max-w-3xl mx-auto">
                    Explore real-time community data, track agency performance, and discover trending issues in your area. 
                    Transparency creates accountability.
                </p>
            </div>
            
            <!-- Real-time Stats -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
                <div class="bg-surface rounded-xl p-6 text-center shadow-card">
                    <div class="text-3xl font-bold text-primary mb-2" id="total-complaints">3,247</div>
                    <div class="text-sm text-text-secondary">Total Complaints</div>
                </div>
                <div class="bg-surface rounded-xl p-6 text-center shadow-card">
                    <div class="text-3xl font-bold text-secondary mb-2" id="resolved-complaints">2,891</div>
                    <div class="text-sm text-text-secondary">Resolved</div>
                </div>
                <div class="bg-surface rounded-xl p-6 text-center shadow-card">
                    <div class="text-3xl font-bold text-warning mb-2" id="avg-resolution">5.2</div>
                    <div class="text-sm text-text-secondary">Avg Days</div>
                </div>
                <div class="bg-surface rounded-xl p-6 text-center shadow-card">
                    <div class="text-3xl font-bold text-accent mb-2" id="satisfaction-rate">94%</div>
                    <div class="text-sm text-text-secondary">Satisfaction</div>
                </div>
            </div>
        </div>
    </section>

    <!-- Search and Filter Section -->
    <section class="py-12 bg-surface border-b border-border">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="bg-background rounded-2xl p-8">
                <div class="flex flex-col lg:flex-row gap-6 items-end">
                    <!-- Search Bar -->
                    <div class="flex-1">
                        <label class="block text-sm font-semibold text-text-primary mb-2">Search Complaints</label>
                        <div class="relative">
                            <input type="text" placeholder="Search by keyword, location, or issue type..." class="input-field pl-12" id="search-input" />
                            <svg class="absolute left-4 top-1/2 transform -translate-y-1/2 w-5 h-5 text-text-secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                            </svg>
                        </div>
                    </div>
                    
                    <!-- Filter Dropdowns -->
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 flex-1">
                        <div>
                            <label for="category-filter" class="block text-sm font-semibold text-text-primary mb-2">Category</label>
                            <select class="input-field text-sm" id="category-filter">
                                <option value>All Categories</option>
                                <option value="roads">Road & Infrastructure</option>
                                <option value="safety">Public Safety</option>
                                <option value="waste">Waste Management</option>
                                <option value="utilities">Water & Utilities</option>
                                <option value="parks">Parks & Recreation</option>
                                <option value="housing">Housing & Zoning</option>
                            </select>
                        </div>
                        
                        <div>
                            <label for="status-filter" class="block text-sm font-semibold text-text-primary mb-2">Status</label>
                            <select class="input-field text-sm" id="status-filter">
                                <option value>All Status</option>
                                <option value="submitted">Submitted</option>
                                <option value="in-progress">In Progress</option>
                                <option value="resolved">Resolved</option>
                                <option value="closed">Closed</option>
                            </select>
                        </div>
                        
                        <div>
                            <label for="priority-filter" class="block text-sm font-semibold text-text-primary mb-2">Priority</label>
                            <select class="input-field text-sm" id="priority-filter">
                                <option value>All Priority</option>
                                <option value="low">Low</option>
                                <option value="medium">Medium</option>
                                <option value="high">High</option>
                                <option value="critical">Critical</option>
                            </select>
                        </div>
                        
                        <div>
                            <label for="date-filter" class="block text-sm font-semibold text-text-primary mb-2">Date Range</label>
                            <select class="input-field text-sm" id="date-filter">
                                <option value>All Time</option>
                                <option value="7">Last 7 Days</option>
                                <option value="30">Last 30 Days</option>
                                <option value="90">Last 3 Months</option>
                                <option value="365">Last Year</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div class="flex gap-3">
                        <button class="btn-primary" id="apply-filters">
                            <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"/>
                            </svg>
                            Filter
                        </button>
                        <button class="btn-outline" id="reset-filters">
                            <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                            </svg>
                            Reset
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Dashboard Content -->
    <section class="py-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid lg:grid-cols-3 gap-8">
                <!-- Main Content Area -->
                <div class="lg:col-span-2 space-y-8">
                    <!-- View Toggle -->
                    <div class="flex justify-between items-center">
                        <h2 class="text-2xl font-bold text-text-primary">Community Complaints</h2>
                        <div class="flex bg-background rounded-lg p-1">
                            <button class="px-4 py-2 rounded-md bg-surface shadow-card text-primary font-semibold" id="list-view">
                                <svg class="w-5 h-5 inline mr-2" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M4 6h16v2H4zm0 5h16v2H4zm0 5h16v2H4z"/>
                                </svg>
                                List
                            </button>
                            <button class="px-4 py-2 rounded-md text-text-secondary hover:text-primary" id="map-view">
                                <svg class="w-5 h-5 inline mr-2" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M20.5 3l-.16.03L15 5.1 9 3 3.36 4.9c-.21.07-.36.25-.36.48V20.5c0 .28.22.5.5.5l.16-.03L9 18.9l6 2.1 5.64-1.9c.21-.07.36-.25.36-.48V3.5c0-.28-.22-.5-.5-.5z"/>
                                </svg>
                                Map
                            </button>
                        </div>
                    </div>

                    <!-- Complaints List -->
                    <div id="complaints-list" class="space-y-6">
                        <!-- Complaint Card 1 -->
                        <div class="card">
                            <div class="flex justify-between items-start mb-4">
                                <div class="flex items-center space-x-3">
                                    <div class="bg-accent-50 p-3 rounded-lg">
                                        <svg class="w-6 h-6 text-accent" fill="currentColor" viewBox="0 0 24 24">
                                            <path d="M9 17a2 2 0 11-4 0 2 2 0 014 0zM19 17a2 2 0 11-4 0 2 2 0 014 0z"/>
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16V6a1 1 0 00-1-1H4a1 1 0 00-1 1v10a1 1 0 001 1h1m8-1a1 1 0 01-1 1H9m4-1V8a1 1 0 011-1h2.586a1 1 0 01.707.293l3.414 3.414a1 1 0 01.293.707V16a1 1 0 01-1 1h-1m-6-1a1 1 0 001 1h1M5 17a2 2 0 104 0m-4 0a2 2 0 114 0m6 0a2 2 0 104 0m-4 0a2 2 0 114 0"/>
                                        </svg>
                                    </div>
                                    <div>
                                        <h3 class="text-lg font-semibold text-text-primary">Large Pothole on Main Street</h3>
                                        <p class="text-text-secondary">Road & Infrastructure • Downtown District</p>
                                    </div>
                                </div>
                                <div class="flex flex-col items-end space-y-2">
                                    <span class="status-error">High Priority</span>
                                    <span class="text-sm text-text-secondary">ID: #2024-1847</span>
                                </div>
                            </div>
                            
                            <p class="text-text-secondary mb-4">
                                Large pothole causing significant traffic delays and potential vehicle damage near the intersection 
                                of Main Street and 5th Avenue. Multiple citizens have reported the issue.
                            </p>
                            
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-4 text-sm text-text-secondary">
                                    <span class="flex items-center">
                                        <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 24 24">
                                            <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                                        </svg>
                                        Main St & 5th Ave
                                    </span>
                                    <span class="flex items-center">
                                        <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 24 24">
                                            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                                        </svg>
                                        23 reports
                                    </span>
                                    <span>Submitted 3 days ago</span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <span class="text-sm font-semibold text-text-primary">City Public Works</span>
                                    <div class="w-3 h-3 bg-warning rounded-full" title="In Progress"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Complaint Card 2 -->
                        <div class="card">
                            <div class="flex justify-between items-start mb-4">
                                <div class="flex items-center space-x-3">
                                    <div class="bg-warning-50 p-3 rounded-lg">
                                        <svg class="w-6 h-6 text-warning" fill="currentColor" viewBox="0 0 24 24">
                                            <path d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
                                        </svg>
                                    </div>
                                    <div>
                                        <h3 class="text-lg font-semibold text-text-primary">Streetlight Outage on Oak Avenue</h3>
                                        <p class="text-text-secondary">Public Safety • Residential Area</p>
                                    </div>
                                </div>
                                <div class="flex flex-col items-end space-y-2">
                                    <span class="status-warning">Medium Priority</span>
                                    <span class="text-sm text-text-secondary">ID: #2024-1823</span>
                                </div>
                            </div>
                            
                            <p class="text-text-secondary mb-4">
                                Multiple streetlights are out along Oak Avenue between 2nd and 6th streets, creating safety 
                                concerns for pedestrians and drivers during evening hours.
                            </p>
                            
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-4 text-sm text-text-secondary">
                                    <span class="flex items-center">
                                        <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 24 24">
                                            <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                                        </svg>
                                        Oak Avenue
                                    </span>
                                    <span class="flex items-center">
                                        <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 24 24">
                                            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                                        </svg>
                                        15 reports
                                    </span>
                                    <span>Submitted 1 week ago</span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <span class="text-sm font-semibold text-text-primary">Electric Utility</span>
                                    <div class="w-3 h-3 bg-warning rounded-full" title="In Progress"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Complaint Card 3 -->
                        <div class="card">
                            <div class="flex justify-between items-start mb-4">
                                <div class="flex items-center space-x-3">
                                    <div class="bg-secondary-50 p-3 rounded-lg">
                                        <svg class="w-6 h-6 text-secondary" fill="currentColor" viewBox="0 0 24 24">
                                            <path d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                        </svg>
                                    </div>
                                    <div>
                                        <h3 class="text-lg font-semibold text-text-primary">Missed Trash Collection - Elm District</h3>
                                        <p class="text-text-secondary">Waste Management • Residential Area</p>
                                    </div>
                                </div>
                                <div class="flex flex-col items-end space-y-2">
                                    <span class="status-success">Resolved</span>
                                    <span class="text-sm text-text-secondary">ID: #2024-1798</span>
                                </div>
                            </div>
                            
                            <p class="text-text-secondary mb-4">
                                Residential area experiencing irregular waste pickup schedule affecting multiple blocks in the 
                                Elm District. Collection trucks have missed scheduled pickups for three consecutive weeks.
                            </p>
                            
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-4 text-sm text-text-secondary">
                                    <span class="flex items-center">
                                        <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 24 24">
                                            <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                                        </svg>
                                        Elm District
                                    </span>
                                    <span class="flex items-center">
                                        <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 24 24">
                                            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                                        </svg>
                                        8 reports
                                    </span>
                                    <span>Resolved 2 days ago</span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <span class="text-sm font-semibold text-text-primary">Waste Management</span>
                                    <div class="w-3 h-3 bg-secondary rounded-full" title="Resolved"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Map View (Hidden by default) -->
                    <div id="map-container" class="hidden">
                        <div class="bg-surface rounded-2xl p-8 shadow-card">
                            <div class="bg-gradient-to-br from-primary-50 to-secondary-50 rounded-xl h-96 flex items-center justify-center">
                                <div class="text-center">
                                    <svg class="w-16 h-16 text-primary mx-auto mb-4" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M20.5 3l-.16.03L15 5.1 9 3 3.36 4.9c-.21.07-.36.25-.36.48V20.5c0 .28.22.5.5.5l.16-.03L9 18.9l6 2.1 5.64-1.9c.21-.07.36-.25.36-.48V3.5c0-.28-.22-.5-.5-.5z"/>
                                    </svg>
                                    <h3 class="text-xl font-semibold text-text-primary mb-2">Interactive Complaint Map</h3>
                                    <p class="text-text-secondary">Heat map visualization showing complaint density across geographic areas</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Pagination -->
                    <div class="flex justify-between items-center">
                        <div class="text-sm text-text-secondary">
                            Showing 1-10 of 247 complaints
                        </div>
                        <div class="flex space-x-2">
                            <button class="px-3 py-2 border border-border rounded-lg text-text-secondary hover:bg-background">Previous</button>
                            <button class="px-3 py-2 bg-primary text-white rounded-lg">1</button>
                            <button class="px-3 py-2 border border-border rounded-lg text-text-secondary hover:bg-background">2</button>
                            <button class="px-3 py-2 border border-border rounded-lg text-text-secondary hover:bg-background">3</button>
                            <button class="px-3 py-2 border border-border rounded-lg text-text-secondary hover:bg-background">Next</button>
                        </div>
                    </div>
                </div>

                <!-- Sidebar -->
                <div class="space-y-8">
                    <!-- Agency Performance -->
                    <div class="card">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-xl font-semibold text-text-primary">Agency Performance</h3>
                            <button class="text-primary hover:text-primary-700 text-sm font-semibold">View All</button>
                        </div>
                        
                        <div class="space-y-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <div class="font-semibold text-text-primary">City Public Works</div>
                                    <div class="text-sm text-text-secondary">Road & Infrastructure</div>
                                </div>
                                <div class="text-right">
                                    <div class="text-lg font-bold text-secondary">92%</div>
                                    <div class="text-sm text-text-secondary">Resolution Rate</div>
                                </div>
                            </div>
                            
                            <div class="flex items-center justify-between">
                                <div>
                                    <div class="font-semibold text-text-primary">Electric Utility</div>
                                    <div class="text-sm text-text-secondary">Public Safety</div>
                                </div>
                                <div class="text-right">
                                    <div class="text-lg font-bold text-secondary">88%</div>
                                    <div class="text-sm text-text-secondary">Resolution Rate</div>
                                </div>
                            </div>
                            
                            <div class="flex items-center justify-between">
                                <div>
                                    <div class="font-semibold text-text-primary">Waste Management</div>
                                    <div class="text-sm text-text-secondary">Sanitation</div>
                                </div>
                                <div class="text-right">
                                    <div class="text-lg font-bold text-secondary">96%</div>
                                    <div class="text-sm text-text-secondary">Resolution Rate</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Trending Categories -->
                    <div class="card">
                        <h3 class="text-xl font-semibold text-text-primary mb-6">Trending This Week</h3>
                        
                        <div class="space-y-4">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <div class="bg-accent-50 p-2 rounded-lg">
                                        <svg class="w-5 h-5 text-accent" fill="currentColor" viewBox="0 0 24 24">
                                            <path d="M9 17a2 2 0 11-4 0 2 2 0 014 0zM19 17a2 2 0 11-4 0 2 2 0 014 0z"/>
                                        </svg>
                                    </div>
                                    <div>
                                        <div class="font-semibold text-text-primary">Road Issues</div>
                                        <div class="text-sm text-text-secondary">+23% this week</div>
                                    </div>
                                </div>
                                <div class="text-accent font-bold">47</div>
                            </div>
                            
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <div class="bg-warning-50 p-2 rounded-lg">
                                        <svg class="w-5 h-5 text-warning" fill="currentColor" viewBox="0 0 24 24">
                                            <path d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
                                        </svg>
                                    </div>
                                    <div>
                                        <div class="font-semibold text-text-primary">Lighting</div>
                                        <div class="text-sm text-text-secondary">+15% this week</div>
                                    </div>
                                </div>
                                <div class="text-warning font-bold">31</div>
                            </div>
                            
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <div class="bg-secondary-50 p-2 rounded-lg">
                                        <svg class="w-5 h-5 text-secondary" fill="currentColor" viewBox="0 0 24 24">
                                            <path d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                        </svg>
                                    </div>
                                    <div>
                                        <div class="font-semibold text-text-primary">Waste Collection</div>
                                        <div class="text-sm text-text-secondary">-8% this week</div>
                                    </div>
                                </div>
                                <div class="text-secondary font-bold">18</div>
                            </div>
                        </div>
                    </div>

                    <!-- Data Export -->
                    <div class="card">
                        <h3 class="text-xl font-semibold text-text-primary mb-6">Data Export</h3>
                        <p class="text-text-secondary mb-6">
                            Download anonymized datasets for research and analysis purposes.
                        </p>
                        
                        <div class="space-y-3">
                            <button class="w-full btn-outline text-left">
                                <svg class="w-5 h-5 inline mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                </svg>
                                Export CSV Data
                            </button>
                            <button class="w-full btn-outline text-left">
                                <svg class="w-5 h-5 inline mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                                </svg>
                                Generate Report
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Analytics Dashboard -->
    <section class="py-16 bg-surface">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-bold text-text-primary mb-4">Analytics Dashboard</h2>
                <p class="text-lg text-text-secondary">
                    Comprehensive insights into community issues and agency performance
                </p>
            </div>
            
            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
                <!-- Resolution Time Chart -->
                <div class="card">
                    <h3 class="text-lg font-semibold text-text-primary mb-4">Average Resolution Time</h3>
                    <div class="bg-gradient-to-br from-primary-50 to-primary-100 rounded-xl h-48 flex items-center justify-center">
                        <svg class="w-full h-full p-4" viewBox="0 0 200 120">
                            <polyline fill="none" stroke="#1E40AF" stroke-width="3" points="20,100 40,85 60,70 80,60 100,45 120,40 140,35 160,30 180,25"/>
                            <circle cx="180" cy="25" r="4" fill="#1E40AF"/>
                        </svg>
                    </div>
                    <div class="mt-4 text-center">
                        <div class="text-2xl font-bold text-primary">4.2 days</div>
                        <div class="text-sm text-text-secondary">12% improvement</div>
                    </div>
                </div>

                <!-- Satisfaction Ratings -->
                <div class="card">
                    <h3 class="text-lg font-semibold text-text-primary mb-4">Citizen Satisfaction</h3>
                    <div class="bg-gradient-to-br from-secondary-50 to-secondary-100 rounded-xl h-48 flex items-center justify-center">
                        <div class="text-center">
                            <div class="relative w-24 h-24 mx-auto mb-4">
                                <svg class="w-24 h-24 transform -rotate-90" viewBox="0 0 100 100">
                                    <circle cx="50" cy="50" r="40" stroke="#E5E7EB" stroke-width="8" fill="none"/>
                                    <circle cx="50" cy="50" r="40" stroke="#059669" stroke-width="8" fill="none" stroke-dasharray="251.2" stroke-dashoffset="25.12"/>
                                </svg>
                                <div class="absolute inset-0 flex items-center justify-center">
                                    <span class="text-2xl font-bold text-secondary">94%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mt-4 text-center">
                        <div class="text-sm text-text-secondary">+3% from last month</div>
                    </div>
                </div>

                <!-- Category Distribution -->
                <div class="card">
                    <h3 class="text-lg font-semibold text-text-primary mb-4">Issue Categories</h3>
                    <div class="space-y-3">
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-text-secondary">Roads & Infrastructure</span>
                            <div class="flex items-center space-x-2">
                                <div class="w-16 bg-border-light rounded-full h-2">
                                    <div class="bg-accent h-2 rounded-full" style="width: 45%"></div>
                                </div>
                                <span class="text-sm font-semibold">45%</span>
                            </div>
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-text-secondary">Public Safety</span>
                            <div class="flex items-center space-x-2">
                                <div class="w-16 bg-border-light rounded-full h-2">
                                    <div class="bg-warning h-2 rounded-full" style="width: 28%"></div>
                                </div>
                                <span class="text-sm font-semibold">28%</span>
                            </div>
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-text-secondary">Waste Management</span>
                            <div class="flex items-center space-x-2">
                                <div class="w-16 bg-border-light rounded-full h-2">
                                    <div class="bg-secondary h-2 rounded-full" style="width: 18%"></div>
                                </div>
                                <span class="text-sm font-semibold">18%</span>
                            </div>
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-text-secondary">Other</span>
                            <div class="flex items-center space-x-2">
                                <div class="w-16 bg-border-light rounded-full h-2">
                                    <div class="bg-primary h-2 rounded-full" style="width: 9%"></div>
                                </div>
                                <span class="text-sm font-semibold">9%</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Call to Action -->
    <section class="py-16 bg-gradient-to-r from-primary-600 to-primary-700">
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <h2 class="text-3xl font-bold text-white mb-4">See an Issue in Your Community?</h2>
            <p class="text-lg text-primary-100 mb-8 max-w-2xl mx-auto">
                Don't wait for someone else to report it. Your voice can make the difference in solving community problems.
            </p>
            <div class="flex flex-col sm:flex-row gap-4 justify-center">
                <a href="submit_complaint.html" class="bg-white text-primary-700 px-8 py-3 rounded-lg font-semibold hover:bg-primary-50 transition-colors">
                    Submit a Complaint
                </a>
                <a href="community_forum.html" class="border-2 border-white text-white px-8 py-3 rounded-lg font-semibold hover:bg-white hover:text-primary-700 transition-colors">
                    Join Discussion
                </a>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-text-primary text-white py-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid md:grid-cols-4 gap-8">
                <div>
                    <div class="flex items-center mb-4">
                        <svg class="h-8 w-8 text-primary mr-3" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2L13.09 8.26L20 9L13.09 9.74L12 16L10.91 9.74L4 9L10.91 8.26L12 2Z"/>
                            <circle cx="12" cy="12" r="3" fill="none" stroke="currentColor" stroke-width="2"/>
                        </svg>
                        <span class="text-xl font-bold">CitizenVoice</span>
                    </div>
                    <p class="text-gray-400 mb-4">
                        Empowering citizens to create positive change in their communities through transparency and accountability.
                    </p>
                </div>
                
                <div>
                    <h3 class="font-semibold mb-4">Quick Links</h3>
                    <ul class="space-y-2 text-gray-400">
                        <li><a href="submit_complaint.html" class="hover:text-white transition-colors">Submit Complaint</a></li>
                        <li><a href="track_progress.html" class="hover:text-white transition-colors">Track Progress</a></li>
                        <li><a href="public_transparency_hub.html" class="hover:text-white transition-colors">Public Hub</a></li>
                        <li><a href="community_forum.html" class="hover:text-white transition-colors">Community Forum</a></li>
                    </ul>
                </div>
                
                <div>
                    <h3 class="font-semibold mb-4">Resources</h3>
                    <ul class="space-y-2 text-gray-400">
                        <li><a href="javascript:void(0)" class="hover:text-white transition-colors">Citizen Rights Guide</a></li>
                        <li><a href="javascript:void(0)" class="hover:text-white transition-colors">Filing Best Practices</a></li>
                        <li><a href="javascript:void(0)" class="hover:text-white transition-colors">Legal Resources</a></li>
                        <li><a href="javascript:void(0)" class="hover:text-white transition-colors">Help Center</a></li>
                    </ul>
                </div>
                
                <div>
                    <h3 class="font-semibold mb-4">Contact</h3>
                    <ul class="space-y-2 text-gray-400">
                        <li>support@citizenvoice.org</li>
                        <li>+23277739013-CITIZEN</li>
                        <li>24/7 Live Chat</li>
                    </ul>
                </div>
            </div>
            
            <div class="border-t border-gray-700 mt-8 pt-8 text-center text-gray-400">
                <p>&copy; 2025 CitizenVoice. All Rights Reserved. | Privacy Policy | Terms of Service</p>
            </div>
        </div>
    </footer>

    <script>
        // Mobile menu toggle
        document.getElementById('mobile-menu-button').addEventListener('click', function() {
            const mobileMenu = document.getElementById('mobile-menu');
            mobileMenu.classList.toggle('hidden');
        });

        // View toggle functionality
        document.getElementById('list-view').addEventListener('click', function() {
            document.getElementById('complaints-list').classList.remove('hidden');
            document.getElementById('map-container').classList.add('hidden');
            this.classList.add('bg-surface', 'shadow-card', 'text-primary', 'font-semibold');
            this.classList.remove('text-text-secondary');
            document.getElementById('map-view').classList.remove('bg-surface', 'shadow-card', 'text-primary', 'font-semibold');
            document.getElementById('map-view').classList.add('text-text-secondary');
        });

        document.getElementById('map-view').addEventListener('click', function() {
            document.getElementById('complaints-list').classList.add('hidden');
            document.getElementById('map-container').classList.remove('hidden');
            this.classList.add('bg-surface', 'shadow-card', 'text-primary', 'font-semibold');
            this.classList.remove('text-text-secondary');
            document.getElementById('list-view').classList.remove('bg-surface', 'shadow-card', 'text-primary', 'font-semibold');
            document.getElementById('list-view').classList.add('text-text-secondary');
        });

        // Filter functionality
        document.getElementById('apply-filters').addEventListener('click', function() {
            // Simulate filtering
            console.log('Applying filters...');
        });

        document.getElementById('reset-filters').addEventListener('click', function() {
            // Reset all filter dropdowns
            document.getElementById('search-input').value = '';
            document.getElementById('category-filter').value = '';
            document.getElementById('status-filter').value = '';
            document.getElementById('priority-filter').value = '';
            document.getElementById('date-filter').value = '';
        });

        // Animate counters on page load
        function animateCounter(elementId, targetValue, duration = 2000) {
            const element = document.getElementById(elementId);
            const startValue = 0;
            const increment = targetValue / (duration / 16);
            let currentValue = startValue;

            const timer = setInterval(() => {
                currentValue += increment;
                if (currentValue >= targetValue) {
                    currentValue = targetValue;
                    clearInterval(timer);
                }
                element.textContent = Math.floor(currentValue).toLocaleString();
            }, 16);
        }

        // Show/hide logout button based on login status
        window.addEventListener('DOMContentLoaded', () => {
            const loginLink = document.getElementById('login-link');
            const logoutBtn = document.getElementById('logout-btn');
            
            if (typeof isLoggedIn === 'function' && isLoggedIn()) {
                if (loginLink) loginLink.classList.add('hidden');
                if (logoutBtn) logoutBtn.classList.remove('hidden');
            } else {
                if (loginLink) loginLink.classList.remove('hidden');
                if (logoutBtn) logoutBtn.classList.add('hidden');
            }
        });
    </script>
    <script src="../public/api.js"></script>
    <script>
        const API_BASE = 'http://localhost:3000/api/public';

        // Load public statistics
        async function loadPublicStats() {
            try {
                console.log('Loading public stats from:', `${API_BASE}/stats`);
                const response = await fetch(`${API_BASE}/stats`);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('Public stats response:', data);
                
                if (data.success && data.data) {
                    const stats = data.data;
                    const totalEl = document.getElementById('total-complaints');
                    const resolvedEl = document.getElementById('resolved-complaints');
                    const avgEl = document.getElementById('avg-resolution');
                    const satisfactionEl = document.getElementById('satisfaction-rate');
                    
                    if (totalEl) {
                        totalEl.textContent = (stats.totalComplaints || 0).toLocaleString();
                    }
                    if (resolvedEl) {
                        resolvedEl.textContent = (stats.resolvedComplaints || 0).toLocaleString();
                    }
                    if (avgEl) {
                        avgEl.textContent = stats.avgResolutionDays || '0.0';
                    }
                    if (satisfactionEl) {
                        satisfactionEl.textContent = `${stats.satisfactionRate || 0}%`;
                    }
                    
                    console.log('Stats updated successfully:', stats);
                } else {
                    console.error('Invalid response format:', data);
                }
            } catch (error) {
                console.error('Error loading public stats:', error);
                // Show error in console but don't break the page
            }
        }

        // Load public complaints
        async function loadPublicComplaints(filters = {}) {
            try {
                const params = new URLSearchParams();
                if (filters.category) params.append('category', filters.category);
                if (filters.status) params.append('status', filters.status);
                if (filters.priority) params.append('priority', filters.priority);
                if (filters.dateRange) params.append('dateRange', filters.dateRange);
                if (filters.search) params.append('search', filters.search);
                if (filters.page) params.append('page', filters.page);
                params.append('limit', '10');

                const response = await fetch(`${API_BASE}/complaints?${params}`);
                const data = await response.json();
                
                if (data.success) {
                    displayComplaints(data.data.complaints);
                    updatePagination(data.data.pagination);
                }
            } catch (error) {
                console.error('Error loading public complaints:', error);
            }
        }

        // Display complaints
        function displayComplaints(complaints) {
            const container = document.getElementById('complaints-list');
            if (!container) return;

            if (complaints.length === 0) {
                container.innerHTML = '<div class="card text-center py-12"><p class="text-text-secondary">No complaints found matching your criteria.</p></div>';
                return;
            }

            container.innerHTML = complaints.map(complaint => {
                const statusClass = {
                    'pending': 'status-error',
                    'in_review': 'status-warning',
                    'resolved': 'status-success'
                }[complaint.status] || 'status-error';
                
                const statusText = {
                    'pending': 'Pending',
                    'in_review': 'In Progress',
                    'resolved': 'Resolved'
                }[complaint.status] || 'Pending';

                const priorityClass = {
                    'low': 'text-secondary',
                    'medium': 'text-warning',
                    'high': 'text-accent',
                    'critical': 'text-error'
                }[complaint.priority] || 'text-text-secondary';

                const priorityText = complaint.priority ? complaint.priority.charAt(0).toUpperCase() + complaint.priority.slice(1) : 'Medium';
                
                const createdDate = new Date(complaint.created_at).toLocaleDateString('en-US', { 
                    year: 'numeric', 
                    month: 'short', 
                    day: 'numeric' 
                });

                const categoryIcon = {
                    'road-infrastructure': '<svg class="w-6 h-6 text-accent" fill="currentColor" viewBox="0 0 24 24"><path d="M9 17a2 2 0 11-4 0 2 2 0 014 0zM19 17a2 2 0 11-4 0 2 2 0 014 0z"/></svg>',
                    'water-utilities': '<svg class="w-6 h-6 text-primary" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2.69l5.66 5.66a8 8 0 11-11.31 0z"/></svg>',
                    'waste-management': '<svg class="w-6 h-6 text-secondary" fill="currentColor" viewBox="0 0 24 24"><path d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>',
                    'public-safety': '<svg class="w-6 h-6 text-warning" fill="currentColor" viewBox="0 0 24 24"><path d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/></svg>'
                }[complaint.category] || '<svg class="w-6 h-6 text-text-secondary" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>';

                const categoryBg = {
                    'road-infrastructure': 'bg-accent-50',
                    'water-utilities': 'bg-primary-50',
                    'waste-management': 'bg-secondary-50',
                    'public-safety': 'bg-warning-50'
                }[complaint.category] || 'bg-background';

                return `
                    <div class="card">
                        <div class="flex justify-between items-start mb-4">
                            <div class="flex items-center space-x-3">
                                <div class="${categoryBg} p-3 rounded-lg">
                                    ${categoryIcon}
                                </div>
                                <div>
                                    <h3 class="text-lg font-semibold text-text-primary">${complaint.title || 'Untitled Complaint'}</h3>
                                    <p class="text-text-secondary">${complaint.category ? complaint.category.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase()) : 'General'} • ${complaint.affected_area || 'N/A'}</p>
                                </div>
                            </div>
                            <div class="flex flex-col items-end space-y-2">
                                <span class="${statusClass}">${statusText}</span>
                                <span class="text-sm text-text-secondary">${complaint.tracking_number || 'N/A'}</span>
                            </div>
                        </div>
                        
                        <p class="text-text-secondary mb-4">
                            ${complaint.description || 'No description provided'}${complaint.description && complaint.description.length > 200 ? '...' : ''}
                        </p>
                        
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-4 text-sm text-text-secondary">
                                ${complaint.location ? `
                                    <span class="flex items-center">
                                        <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 24 24">
                                            <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                                        </svg>
                                        ${complaint.location}
                                    </span>
                                ` : ''}
                                ${complaint.similar_count > 0 ? `
                                    <span class="flex items-center">
                                        <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 24 24">
                                            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                                        </svg>
                                        ${complaint.similar_count} similar reports
                                    </span>
                                ` : ''}
                                <span>Submitted ${createdDate}</span>
                            </div>
                            ${complaint.agency_name ? `
                                <div class="flex items-center space-x-2">
                                    <span class="text-sm font-semibold text-text-primary">${complaint.agency_name}</span>
                                    <div class="w-3 h-3 ${statusText === 'Resolved' ? 'bg-secondary' : 'bg-warning'} rounded-full" title="${statusText}"></div>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Update pagination
        function updatePagination(pagination) {
            // Update pagination UI if needed
            const paginationInfo = document.querySelector('.text-sm.text-text-secondary');
            if (paginationInfo && paginationInfo.textContent.includes('Showing')) {
                const start = (pagination.page - 1) * pagination.limit + 1;
                const end = Math.min(pagination.page * pagination.limit, pagination.total);
                paginationInfo.textContent = `Showing ${start}-${end} of ${pagination.total} complaints`;
            }
        }

        // Load agency performance
        async function loadAgencyPerformance() {
            try {
                const response = await fetch(`${API_BASE}/agencies/performance`);
                const data = await response.json();
                
                if (data.success && data.data.agencies.length > 0) {
                    const container = document.querySelector('.card .space-y-4');
                    if (container && container.parentElement.querySelector('h3').textContent.includes('Agency Performance')) {
                        container.innerHTML = data.data.agencies.slice(0, 3).map(agency => `
                            <div class="flex items-center justify-between">
                                <div>
                                    <div class="font-semibold text-text-primary">${agency.name}</div>
                                    <div class="text-sm text-text-secondary">${agency.total_complaints} complaints</div>
                                </div>
                                <div class="text-right">
                                    <div class="text-lg font-bold text-secondary">${agency.resolution_rate}%</div>
                                    <div class="text-sm text-text-secondary">Resolution Rate</div>
                                </div>
                            </div>
                        `).join('');
                    }
                }
            } catch (error) {
                console.error('Error loading agency performance:', error);
            }
        }

        // Load trending categories
        async function loadTrendingCategories() {
            try {
                const response = await fetch(`${API_BASE}/categories/trending?days=7`);
                const data = await response.json();
                
                if (data.success && data.data.categories.length > 0) {
                    const container = document.querySelectorAll('.card .space-y-4')[1];
                    if (container) {
                        const categories = data.data.categories.slice(0, 3);
                        const categoryIcons = {
                            'road-infrastructure': '<svg class="w-5 h-5 text-accent" fill="currentColor" viewBox="0 0 24 24"><path d="M9 17a2 2 0 11-4 0 2 2 0 014 0zM19 17a2 2 0 11-4 0 2 2 0 014 0z"/></svg>',
                            'water-utilities': '<svg class="w-5 h-5 text-primary" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2.69l5.66 5.66a8 8 0 11-11.31 0z"/></svg>',
                            'waste-management': '<svg class="w-5 h-5 text-secondary" fill="currentColor" viewBox="0 0 24 24"><path d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>',
                            'public-safety': '<svg class="w-5 h-5 text-warning" fill="currentColor" viewBox="0 0 24 24"><path d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/></svg>'
                        };
                        
                        const categoryBgs = {
                            'road-infrastructure': 'bg-accent-50',
                            'water-utilities': 'bg-primary-50',
                            'waste-management': 'bg-secondary-50',
                            'public-safety': 'bg-warning-50'
                        };

                        container.innerHTML = categories.map(cat => {
                            const categoryName = cat.category.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                            return `
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center space-x-3">
                                        <div class="${categoryBgs[cat.category] || 'bg-background'} p-2 rounded-lg">
                                            ${categoryIcons[cat.category] || '<svg class="w-5 h-5 text-text-secondary" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>'}
                                        </div>
                                        <div>
                                            <div class="font-semibold text-text-primary">${categoryName}</div>
                                            <div class="text-sm text-text-secondary">${cat.changePercent} this week</div>
                                        </div>
                                    </div>
                                    <div class="text-accent font-bold">${cat.count}</div>
                                </div>
                            `;
                        }).join('');
                    }
                }
            } catch (error) {
                console.error('Error loading trending categories:', error);
            }
        }

        // Filter functionality
        let currentFilters = {};
        
        document.getElementById('apply-filters').addEventListener('click', function() {
            currentFilters = {
                category: document.getElementById('category-filter').value,
                status: document.getElementById('status-filter').value,
                priority: document.getElementById('priority-filter').value,
                dateRange: document.getElementById('date-filter').value,
                search: document.getElementById('search-input').value
            };
            loadPublicComplaints(currentFilters);
        });

        document.getElementById('reset-filters').addEventListener('click', function() {
            document.getElementById('search-input').value = '';
            document.getElementById('category-filter').value = '';
            document.getElementById('status-filter').value = '';
            document.getElementById('priority-filter').value = '';
            document.getElementById('date-filter').value = '';
            currentFilters = {};
            loadPublicComplaints();
        });

        // Search functionality
        let searchTimeout;
        document.getElementById('search-input').addEventListener('input', function(e) {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                currentFilters.search = e.target.value;
                loadPublicComplaints(currentFilters);
            }, 500);
        });

        // Initialize on page load
        window.addEventListener('DOMContentLoaded', () => {
            console.log('Initializing Public Transparency Hub...');
            
            // Load all data immediately
            loadPublicStats();
            loadPublicComplaints();
            loadAgencyPerformance();
            loadTrendingCategories();
            
            // Refresh data every 30 seconds
            setInterval(() => {
                console.log('Refreshing public data...');
                loadPublicStats();
                loadPublicComplaints(currentFilters);
                loadAgencyPerformance();
                loadTrendingCategories();
            }, 30000);
        });
        
        // Also try loading on window load as fallback
        window.addEventListener('load', () => {
            // Double-check stats are loaded
            const totalEl = document.getElementById('total-complaints');
            if (totalEl && (totalEl.textContent === '3,247' || totalEl.textContent === '3247')) {
                console.log('Stats still showing default values, reloading...');
                loadPublicStats();
            }
        });
    </script>
<script id="dhws-dataInjector" src="../public/dhws-data-injector.js"></script>
</body>
</html>